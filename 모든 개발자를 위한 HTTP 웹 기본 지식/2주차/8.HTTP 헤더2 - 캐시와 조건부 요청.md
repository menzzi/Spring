# HTTP ν—¤λ”2 - μΊμ‹μ™€ μ΅°κ±΄λ¶€ μ”μ²­

# μΊμ‹ κΈ°λ³Έ λ™μ‘

****μΊμ‹κ°€ μ—†μ„ λ•****

- λ°μ΄ν„°κ°€ λ³€κ²½λμ§€ μ•μ•„λ„ κ³„μ† λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄μ„ λ°μ΄ν„°λ¥Ό λ‹¤μ΄λ΅λ“ λ°›μ•„μ•Ό ν•λ‹¤.
- μΈν„°λ„· λ„¤νΈμ›ν¬λ” λ§¤μ° λλ¦¬κ³  λΉ„μ‹Έλ‹¤.
- λΈλΌμ°μ € λ΅λ”© μ†λ„κ°€ λλ¦¬λ‹¤.
- λλ¦° μ‚¬μ©μ κ²½ν—

****μΊμ‹ μ μ©****

- μΊμ‹ λ•λ¶„μ— μΊμ‹ κ°€λ¥ μ‹κ°„λ™μ• λ„¤νΈμ›ν¬λ¥Ό μ‚¬μ©ν•μ§€ μ•μ•„λ„ λλ‹¤.
- λΉ„μ‹Ό λ„¤νΈμ›ν¬ μ‚¬μ©λ‰μ„ μ¤„μΌ μ μλ‹¤.
- λΈλΌμ°μ € λ΅λ”© μ†λ„κ°€ λ§¤μ° λΉ λ¥΄λ‹¤.
- λΉ λ¥Έ μ‚¬μ©μ κ²½ν—

****μΊμ‹ μ‹κ°„ μ΄κ³Ό****

- μΊμ‹ μ ν¨ μ‹κ°„μ΄ μ΄κ³Όν•λ©΄, μ„λ²„λ¥Ό ν†µν•΄ λ°μ΄ν„°λ¥Ό λ‹¤μ‹ μ΅°νν•κ³ , μΊμ‹λ¥Ό κ°±μ‹ ν•λ‹¤.
- μ΄λ• λ‹¤μ‹ λ„¤νΈμ›ν¬ λ‹¤μ΄λ΅λ“κ°€ λ°μƒν•λ‹¤.
****

# **κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­1**

μΊμ‹ μ ν¨ μ‹κ°„μ΄ μ΄κ³Όν•΄μ„ μ„λ²„μ— λ‹¤μ‹ μ”μ²­ν•λ©΄ λ‹¤μ λ‘ κ°€μ§€ μƒν™©μ΄ λ‚νƒ€λ‚λ‹¤.
1. μ„λ²„μ—μ„κΈ°μ΅΄λ°μ΄ν„°λ¥Όλ³€κ²½ν•¨  2. μ„λ²„μ—μ„κΈ°μ΅΄λ°μ΄ν„°λ¥Όλ³€κ²½ν•μ§€μ•μ

> μΊμ‹ λ§λ£ν›„μ—λ„ μ„λ²„μ—μ„ λ°μ΄ν„°λ¥Ό λ³€κ²½ν•μ§€ μ•μ
μƒκ°ν•΄λ³΄λ©΄ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•λ” λ€μ‹ μ— μ €μ¥ν•΄ λ‘μ—λ μΊμ‹λ¥Ό μ¬μ‚¬μ© ν•  μ μλ‹¤.λ‹¨ ν΄λΌμ΄μ–ΈνΈμ λ°μ΄ν„°μ™€ μ„λ²„μ λ°μ΄ν„°κ°€ κ°™λ‹¤λ” μ‚¬μ‹¤μ„ ν™•μΈν•  μ μλ” λ°©λ²• ν•„μ”
> 

[ μ •λ¦¬ ] 

- μΊμ‹ μ ν¨ μ‹κ°„μ΄ μ΄κ³Όν•΄λ„, μ„λ²„μ λ°μ΄ν„°κ°€ κ°±μ‹ λμ§€ μ•μΌλ©΄
- 304 Not Modified + ν—¤λ” λ©”νƒ€ μ •λ³΄λ§ μ‘λ‹µ(λ°”λ””X)
- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„κ°€ λ³΄λ‚Έ μ‘λ‹µ ν—¤λ” μ •λ³΄λ΅ μΊμ‹μ λ©”νƒ€ μ •λ³΄λ¥Ό κ°±μ‹ 
- ν΄λΌμ΄μ–ΈνΈλ” μΊμ‹μ— μ €μ¥λμ–΄ μλ” λ°μ΄ν„° μ¬ν™μ©
- κ²°κ³Όμ μΌλ΅ λ„¤νΈμ›ν¬ λ‹¤μ΄λ΅λ“κ°€ λ°μƒν•μ§€λ§ μ©λ‰μ΄ μ μ€ ν—¤λ” μ •λ³΄λ§ λ‹¤μ΄λ΅λ“

β†’ λ§¤μ° μ‹¤μ©μ μΈ ν•΄κ²°μ±…

# **κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­2**

**κ²€μ¦ ν—¤λ”**

- μΊμ‹ λ°μ΄ν„°μ™€ μ„λ²„ λ°μ΄ν„°κ°€ κ°™μ€μ§€ κ²€μ¦ν•λ” λ°μ΄ν„°
- Last-Modified , ETag

**μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”**

- κ²€μ¦ ν—¤λ”λ΅ μ΅°κ±΄μ— λ”°λ¥Έ λ¶„κΈ°
- If-Modified-Since: Last-Modified μ‚¬μ©
- If-None-Match: ETag μ‚¬μ©
- μ΅°κ±΄μ΄ λ§μ΅±ν•λ©΄ 200 OK
- μ΅°κ±΄μ΄ λ§μ΅±ν•μ§€ μ•μΌλ©΄ 304 Not Modified

<aside>
π—£ **If-Modified-Since**
**λ°μ΄ν„° λ―Έλ³€κ²½ μμ‹**

μΊμ‹: 2020λ…„ 11μ›” 10μΌ 10:00:00 vs μ„λ²„: 2020λ…„ 11μ›” 10μΌ 10:00:00
**304 Not Modified**, ν—¤λ” λ°μ΄ν„°λ§ μ „μ†΅(BODY λ―Έν¬ν•¨)/μ „μ†΅ μ©λ‰ 0.1M (ν—¤λ” 0.1M, λ°”λ”” 1.0M)

**λ°μ΄ν„° λ³€κ²½ μμ‹**

μΊμ‹: 2020λ…„ 11μ›” 10μΌ 10:00:00 vs μ„λ²„: 2020λ…„ 11μ›” 10μΌ **11**:00:00
**200 OK**, λ¨λ“  λ°μ΄ν„° μ „μ†΅(BODY ν¬ν•¨)/μ „μ†΅ μ©λ‰ 1.1M (ν—¤λ” 0.1M, λ°”λ”” 1.0M)

</aside>

>> λ‹¨μ (Last-Modified,If-Modified-Since)

1μ΄ λ―Έλ§(0.xμ΄) λ‹¨μ„λ΅ μΊμ‹ μ΅°μ •μ΄ λ¶κ°€λ¥
λ‚ μ§ κΈ°λ°μ λ΅μ§ μ‚¬μ©
λ°μ΄ν„°λ¥Ό μμ •ν•΄μ„ λ‚ μ§κ°€ λ‹¤λ¥΄μ§€λ§, κ°™μ€ λ°μ΄ν„°λ¥Ό μμ •ν•΄μ„ λ°μ΄ν„° κ²°κ³Όκ°€ λ‘κ°™μ€ κ²½μ°(Aβ†’Bμμ •ν•κ³  λ Bβ†’A μμ •)
μ„λ²„μ—μ„ λ³„λ„μ μΊμ‹ λ΅μ§μ„ κ΄€λ¦¬ν•κ³  μ‹¶μ€ κ²½μ°

μ) μ¤νμ΄μ¤λ‚ μ£Όμ„μ²λΌ ν¬κ² μν–¥μ΄ μ—†λ” λ³€κ²½μ—μ„ μΊμ‹λ¥Ό μ μ§€ν•κ³  μ‹¶μ€ κ²½μ°

**ETag(Entity Tag) β†’ λ‹¨μ  ν•΄κ²°**

- μΊμ‹μ© λ°μ΄ν„°μ— μ„μμ κ³ μ ν• λ²„μ „ μ΄λ¦„μ„ λ‹¬μ•„λ‘ 

μ) ETag: "v1.0", ETag: "a2jiodwjekjl3"

- λ°μ΄ν„°κ°€ λ³€κ²½λλ©΄ μ΄ μ΄λ¦„μ„ λ°”κΎΈμ–΄μ„ λ³€κ²½ν•¨(Hashλ¥Ό λ‹¤μ‹ μƒμ„±)

μ) ETag: "aaaaa" -> ETag: "bbbbb"

- μ§„μ§ λ‹¨μν•κ² ETagλ§ λ³΄λ‚΄μ„ κ°™μΌλ©΄ μ μ§€, λ‹¤λ¥΄λ©΄ λ‹¤μ‹ λ°›κΈ°!

# **μΊμ‹μ™€ μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”**

**μΊμ‹ μ μ–΄ ν—¤λ”**

**Cache-Control: μΊμ‹ μ μ–΄
Pragma: μΊμ‹ μ μ–΄(ν•μ„ νΈν™)
Expires: μΊμ‹ μ ν¨ κΈ°κ°„(ν•μ„ νΈν™)**

****Cache-Control
μΊμ‹ μ§€μ‹μ–΄(directives)****

- Cache-Control: max-age β†’ μΊμ‹ μ ν¨κΈ°κ°„,μ΄ λ‹¨μ„
- Cache-Control: no-cache β†’ λ°μ΄ν„°λ” μΊμ‹ν•΄λ„ λμ§€λ§, ν•­μƒ μ›(origin) μ„λ²„μ— κ²€μ¦ν•κ³  μ‚¬μ©(μ΅°κ±΄λ¶€ μ”μ²­ ν•΄μ„ κ²€μ¦ν•΄μ•Όν•¨)
- Cache-Control: no-store β†’ λ°μ΄ν„°μ— λ―Όκ°ν• μ •λ³΄κ°€ μμΌλ―€λ΅ μ €μ¥ν•λ©΄ μ•λ¨(λ©”λ¨λ¦¬μ—μ„ μ‚¬μ©ν•κ³  μµλ€ν• λΉ¨λ¦¬ μ‚­μ )

**Pragma**

**μΊμ‹ μ μ–΄(ν•μ„ νΈν™)**

- Pragma: no-cache
- HTTP 1.0 ν•μ„ νΈν™

**Expires**

**μΊμ‹ λ§λ£μΌ μ§€μ •(ν•μ„ νΈν™)**

- expires: Mon, 01 Jan 1990 00:00:00 GMT
- μΊμ‹ λ§λ£μΌμ„ μ •ν™•ν• λ‚ μ§λ΅ μ§€μ •HTTP 1.0 λ¶€ν„° μ‚¬μ©
- μ§€κΈμ€ λ” μ μ—°ν• Cache-Control: max-age κ¶μ¥
- Cache-Control: max-ageμ™€ ν•¨κ» μ‚¬μ©ν•λ©΄ Expiresλ” λ¬΄μ‹

**κ²€μ¦ ν—¤λ” (Validator)**

- **ETag**: "v1.0", **ETag**: "asid93jkrh2l"
- **Last-Modified**: Thu, 04 Jun 2020 07:19:24 GMT

**μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”**

- If-Match, If-None-Match: ETag κ°’ μ‚¬μ©
- If-Modified-Since, If-Unmodified-Since: Last-Modified κ°’ μ‚¬μ©

# **ν”„λ΅μ‹ μΊμ‹**

<img width="700" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-05-18 α„‹α…©α„’α…® 5 57 42" src="https://github.com/menzzi/Spring/assets/124131845/bc8c3a42-b11a-4deb-9d70-717340434970">


ν”„λ΅μ‹ μΊμ‹ μ„λ²„ μ—†μ΄ λ°”λ΅ λ―Έκµ­μ— μλ” μ› μ„λ²„λ΅ κ°€λ©΄ μ‹κ°„μ΄ μ¤λ κ±Έλ¦°λ‹¤.

**Cache-Control**
μΊμ‹ μ§€μ‹μ–΄(directives) - κΈ°νƒ€

- Cache-Control: public β†’μ‘λ‹µμ΄ public μΊμ‹μ— μ €μ¥λμ–΄λ„ λ¨
- Cache-Control: private β†’ μ‘λ‹µμ΄ ν•΄λ‹Ή μ‚¬μ©μλ§μ„ μ„ν• κ²ƒμ„, private μΊμ‹μ— μ €μ¥ν•΄μ•Ό ν•¨(κΈ°λ³Έκ°’)
- Cache-Control: s-maxage β†’ν”„λ΅μ‹ μΊμ‹μ—λ§ μ μ©λλ” max-age (μ°Έκ³ )
- Age: 60 (HTTP ν—¤λ”) β†’ μ¤λ¦¬μ§„ μ„λ²„μ—μ„ μ‘λ‹µ ν›„ ν”„λ΅μ‹ μΊμ‹ λ‚΄μ— λ¨Έλ¬Έ μ‹κ°„(μ΄) (μ°Έκ³ )

# **μΊμ‹ λ¬΄ν¨ν™”**

**Cache-Control**

μΊμ‹ μ§€μ‹μ–΄(directives) - ν™•μ‹¤ν• μΊμ‹ λ¬΄ν¨ν™”

- ****Cache-Control:****
    1. **no-cache : λ°μ΄ν„°λ” μΊμ‹ν•΄λ„ λμ§€λ§, ν•­μƒ μ› μ„λ²„μ— κ²€μ¦ν•κ³  μ‚¬μ©(μ΄λ¦„μ— μ£Όμ!)**
    2. ****no-store :**** λ°μ΄ν„°μ— λ―Όκ°ν• μ •λ³΄κ°€ μμΌλ―€λ΅ μ €μ¥ν•λ©΄ μ•λ¨
    (λ©”λ¨λ¦¬μ—μ„ μ‚¬μ©ν•κ³  μµλ€ν• λΉ¨λ¦¬ μ‚­μ )
    3. ****must-revalidate :**** μΊμ‹ λ§λ£ν›„ μµμ΄ μ΅°νμ‹ **μ› μ„λ²„μ— κ²€μ¦**ν•΄μ•Όν•¨
    μ› μ„λ²„ μ ‘κ·Ό μ‹¤ν¨μ‹ λ°λ“μ‹ μ¤λ¥κ°€ λ°μƒν•΄μ•Όν•¨ - 504(Gateway Timeout)
    must-revalidateλ” μΊμ‹ μ ν¨ μ‹κ°„μ΄λΌλ©΄ μΊμ‹λ¥Ό μ‚¬μ©ν•¨
- ****Pragma: no-cache****

β†’ μ λ€λ΅ μΊμ‹κ°€ λλ©΄ μ•λΌ. ν•  λ• λ‹¤ λ„£μ–΄ μ£Όλ©΄ λλ‹¤

ex) μ‚¬μ©μμ ν†µμ¥ μ”κ³  : κ³„μ† κ°±μ‹ μ΄ λ  μ μκΈ°μ— μΊμ‹ν•λ©΄ μ• λλ‹¤.
<img width="700" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-05-18 α„‹α…©α„’α…® 6 16 22" src="https://github.com/menzzi/Spring/assets/124131845/eaf6b221-8c4d-4d0a-a531-3f28489d1a2f">

<img width="700" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-05-18 α„‹α…©α„’α…® 6 16 51" src="https://github.com/menzzi/Spring/assets/124131845/c029fd74-a1de-4023-a1b6-fcd86d2ffdb2">

<img width="700" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-05-18 α„‹α…©α„’α…® 6 20 23" src="https://github.com/menzzi/Spring/assets/124131845/8d8c1f2a-92f4-4f41-97cf-a6b3bca17a15">
