# 스프링 컨테이너와 스프링 빈

## 스프링 컨테이너 생성

```java
//스프링 컨테이너 생성
ApplicationContext applicationContext =
                  new AnnotationConfigApplicationContext(AppConfig.class);
```

ApplicationContext = 스프링 컨테이너 & 인터페이스

스프링 컨테이너는 XML을 기반으로 만들 수도 있고 애노테이션 기반의 자바 설정 클래스로 만들 수 있다. 요즘은 애노테이션 기반으로 많이 함.

→ AppConfig 를 사용했던 방식 new AnnotationConfigApplicationContext(AppConfig.class);

>> new AnnotationConfigApplicationContext(AppConfig.class)

![스크린샷 2023-04-19 오후 2.29.43.png](%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%8B%E1%85%AA%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%87%E1%85%B5%E1%86%AB%201727877eb63a4697b7ed09c0a0f0365f/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-19_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.29.43.png)

빈 이름 = 키 , 빈 객체 = 값

- 스프링 컨테이너를 생성할 때 구성 정보를 지정해줘야 한다 → AppConfig를 파라미터로 넘김

> 주의) 빈 이름은 항상 다른 이름을 부여해야한다.
> 

![스크린샷 2023-04-19 오후 2.32.33.png](%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%8B%E1%85%AA%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%87%E1%85%B5%E1%86%AB%201727877eb63a4697b7ed09c0a0f0365f/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-19_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.32.33.png)

- 빈 이름은 주로 메서드 이름을 사용하지만, `@Bean(name="memberService2")`
이렇게 직접 부여할 수 도 있다.

**3.스프링 빈 의존관계 설정** 

![스크린샷 2023-04-19 오후 2.43.39.png](%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%8B%E1%85%AA%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%87%E1%85%B5%E1%86%AB%201727877eb63a4697b7ed09c0a0f0365f/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-19_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.43.39.png)

스프링 컨테이너는 설정 정보를 참고해서 DI 한다.

## 컨테이너에 등록된 모든 빈 조회

## 스프링 빈 조회 - 기본

```java
@Test
    @DisplayName("빈 이름으로 조회 x")
    void findBeanByNameX() {
//         ac.getBean("xxxxx", MemberService.class);
         assertThrows(NoSuchBeanDefinitionException.class,
                ()->ac.getBean("xxxxx", MemberService.class));
         // 오른쪽 로직을 실행하면 왼쪽 Exception이 터져야한다.
        // 예외 터지면 성공 안 터지면 실패
    }
```

## 스프링 빈 조회 - 동일한 타입이 둘 이상

🚫 타입으로 조회시 같은 타입의 스프링 빈이 둘 이상이면 오류가 발생한다.

→ 이때는 빈 이름을 지정하자.

```java
@Configuration
    static class SameBeanConfig {

        // MemberRepository 가 두개 이상. -> 오류 발생
        @Bean
        public MemberRepository memberRepository1(){
            return new MemoryMemberRepository();
        }
        @Bean
        public MemberRepository memberRepository2(){
            return new MemoryMemberRepository();
        }
    }
```

![스크린샷 2023-04-21 오후 3.11.27.png](%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%8B%E1%85%AA%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%87%E1%85%B5%E1%86%AB%201727877eb63a4697b7ed09c0a0f0365f/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-21_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.11.27.png)

NoUniqueBeanDefinitionException 발생

## 스프링 빈 조회 - 상속 관계

스프링 빈 조회의 기본 원칙 : 부모 타입으로 조회하면 자식 타입도 함께 조회된다.

→ 자바 객체의 최고 조상인 ‘object’ 타입으로 조회하면 ,모든 스프링 빈을 조회한다.

🚫 부모 타입으로 조회시 자식이 둘 이상 있으면 중복 오류가 발생한다.

- 코드
    
    ```java
    @Test
        @DisplayName("부모 타입으로 조회시 자식이 둘 이상 있으면, 중복 오류가 발생한다")
        void FinBeanByParentTypeDuplicate(){
            assertThrows(NoUniqueBeanDefinitionException.class,
                    () -> ac.getBean(DiscountPolicy.class));
    
        }
        @Test
        @DisplayName("부모 타입으로 조회시 자식이 둘 이상 있으면, 빈 이름을 지정하면 된다")
        void FinBeanByParentTypeBeanName(){
            DiscountPolicy rateDiscountPolicy = ac.getBean("rateDiscountPolicy", DiscountPolicy.class);
            assertThat(rateDiscountPolicy).isInstanceOf(RateDiscountPolicy.class);
    
        }
    
        @Test
        @DisplayName("특정 하위 타입으로 조회") // 별로 좋지 않은 방법
        void findBeanBySubType(){
            RateDiscountPolicy bean = ac.getBean(RateDiscountPolicy.class);
            assertThat(bean).isInstanceOf(RateDiscountPolicy.class);
        }
        @Test
        @DisplayName("부모 타입으로 모두 조회하기")
        void findAllBeanByParentType(){
            Map<String, DiscountPolicy> beansOfType = ac.getBeansOfType(DiscountPolicy.class);
            assertThat(beansOfType.size()).isEqualTo(2);
            for (String key : beansOfType.keySet()) {
                System.out.println("key = " + key + " value = " + beansOfType.get(key));
            }
        }
        @Test
        @DisplayName("부모 타입으로 모두 조회하기 - Object")
        void findAllBeanByObjectType(){
            Map<String, Object> beansOfType = ac.getBeansOfType(Object.class);
            for (String key : beansOfType.keySet()) {
                System.out.println("key = " + key + " value = " + beansOfType.get(key));
            }
    
        }
    
        @Configuration
        static class TestConfig {
    
            @Bean
            public DiscountPolicy rateDiscountPolicy(){
                return new RateDiscountPolicy();
            }
    
            @Bean
            public DiscountPolicy fixDiscountPolicy(){
                return new FixDiscountPolicy();
            }
    
        }
    ```
    

## BeanFactory와 ApplicationContext

![스크린샷 2023-04-21 오후 4.56.24.png](%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%8B%E1%85%AA%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%87%E1%85%B5%E1%86%AB%201727877eb63a4697b7ed09c0a0f0365f/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-21_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.56.24.png)

**BeanFactory**

스프링 컨테이너의 최상위 인터페이스
스프링 빈을 관리하고 조회하는 역할을 담당

getBean() 을 제공 (지금까지 우리가 사용했던 대부분의 기능은 BeanFactory가 제공하는 기능)

**ApplicationContext**

BeanFactory 기능을 모두 상속받아서 제공

<aside>
❓ 빈을 관리하고 검색하는 기능을 BeanFactory가 제공해주는데, 그러면 둘의 차이가 뭘까?

:ApplicationContext는 빈 관리기능 + 편리한 부가 기능을 제공한다.

</aside>

>> BeanFactory를 직접 사용할 일은 거의 없다. 부가기능이 포함된 ApplicationContext를 사용한다.

>> BeanFactory나 ApplicationContext를 스프링 컨테이너라 한다.

## 다양한 설정 형식 지원 - 자바 코드,XML

![스프링 컨테이너는 다양한 형식의 설정 정보를 받아드릴 수 있게 유연하게 설계되어 있다.](%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%8B%E1%85%AA%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%87%E1%85%B5%E1%86%AB%201727877eb63a4697b7ed09c0a0f0365f/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-24_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_12.33.01.png)

스프링 컨테이너는 다양한 형식의 설정 정보를 받아드릴 수 있게 유연하게 설계되어 있다.

→ 심지어 임의의 무언가를 만들 수도 있다.

- GenericXml : 자바 코드가 아니라  Xml 이라는 문서를 설정 정보로 사용하는 것.
    - 컴파일 없이 빈 설정 정보를 변경할 수 있다는 장점!!
    - 그냥 Xml 설정 파일을 넘기면 된다.

주로 자바 코드 기반의 AnnotationConfig를 많이 사용하고 과거에 Xml을 많이 사용했다. 그래서 한번쯤 공부해보는 것이 좋음!!

![스크린샷 2023-04-24 오후 12.47.51.png](%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%8B%E1%85%AA%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%87%E1%85%B5%E1%86%AB%201727877eb63a4697b7ed09c0a0f0365f/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-24_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_12.47.51.png)

Xml 파일은 resources!! ( * 자바 코드가 아닌건 다 resources에 두면 된다. )

## 스프링 빈 설정 메타 정보 - BeanDefinition

스프링은 BeanDefinition으로 빈 설정 메타 정보를 추상화 한다.