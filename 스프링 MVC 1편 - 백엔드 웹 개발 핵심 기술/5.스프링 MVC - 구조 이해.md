# ìŠ¤í”„ë§ MVC - êµ¬ì¡° ì´í•´

# **ìŠ¤í”„ë§ MVC ì „ì²´ êµ¬ì¡°**

<img width="700" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-06-14 á„‹á…©á„’á…® 1 03 37" src="https://github.com/menzzi/Spring/assets/124131845/f7f2b996-bf15-4d80-847b-10fc77c32112">

ìŠ¤í”„ë§ MVC êµ¬ì¡°

<img width="700" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-06-14 á„‹á…©á„’á…® 1 03 56" src="https://github.com/menzzi/Spring/assets/124131845/2a758be3-e81a-4cba-beb0-6db693edfe25">

> **ì§ì ‘ ë§Œë“  í”„ë ˆì„ì›Œí¬ ìŠ¤í”„ë§ MVC ë¹„êµ
-** FrontController â†’ DispatcherServlet
- handlerMappingMap â†’ HandlerMapping
- MyHandlerAdapter â†’ HandlerAdapter
- ModelView â†’ ModelAndView
- viewResolver â†’ ViewResolver
- MyView â†’ View
> 

org.springframework.web.servlet.DispatcherServlet

â†’ ìŠ¤í”„ë§ MVCì˜ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë°”ë¡œ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿(DispatcherServlet)ì´ë‹¤. 

â†’ ì´ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ì´ ë°”ë¡œ ìŠ¤í”„ë§ MVCì˜ í•µì‹¬ì´ë‹¤.

**DispacherServlet ì„œë¸”ë¦¿ ë“±ë¡**

DispacherServlet ë„ ë¶€ëª¨ í´ë˜ìŠ¤ì—ì„œ HttpServlet ì„ ìƒì† ë°›ì•„ì„œ ì‚¬ìš©í•˜ê³ , ì„œë¸”ë¦¿ìœ¼ë¡œ ë™ì‘í•œë‹¤.

- DispatcherServlet â†’ FrameworkServlet â†’ HttpServletBean â†’ HttpServlet

ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” DispacherServlet ì„ ì„œë¸”ë¦¿ìœ¼ë¡œ ìë™ìœ¼ë¡œ ë“±ë¡í•˜ë©´ì„œ **ëª¨ë“  ê²½ë¡œ**( urlPatterns="/" )ì—
ëŒ€í•´ì„œ ë§¤í•‘í•œë‹¤.

ì°¸ê³ : ë” ìì„¸í•œ ê²½ë¡œê°€ ìš°ì„ ìˆœìœ„ê°€ ë†’ë‹¤. ê·¸ë˜ì„œ ê¸°ì¡´ì— ë“±ë¡í•œ ì„œë¸”ë¦¿ë„ í•¨ê»˜ ë™ì‘í•œë‹¤.

**ìš”ì²­ íë¦„**

- ì„œë¸”ë¦¿ì´ í˜¸ì¶œë˜ë©´ HttpServlet ì´ ì œê³µí•˜ëŠ” serivce() ê°€ í˜¸ì¶œëœë‹¤.
- ìŠ¤í”„ë§ MVCëŠ” DispatcherServlet ì˜ ë¶€ëª¨ì¸ FrameworkServlet ì—ì„œ service() ë¥¼ ì˜¤ë²„ë¼ì´ë“œ
í•´ë‘ì—ˆë‹¤.
- FrameworkServlet.service() ë¥¼ ì‹œì‘ìœ¼ë¡œ ì—¬ëŸ¬ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ë©´ì„œDispacherServlet.doDispatch() ê°€ í˜¸ì¶œëœë‹¤.
- ìµœëŒ€í•œ ê°„ë‹¨íˆ ì„¤ëª…í•˜ê¸° ìœ„í•´ ì˜ˆì™¸ì²˜ë¦¬, ì¸í„°ì…‰í„° ê¸°ëŠ¥ì€ ì œì™¸í–ˆë‹¤.

**ë™ì‘ ìˆœì„œ**

1. **í•¸ë“¤ëŸ¬ ì¡°íšŒ**: í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ í†µí•´ ìš”ì²­ URLì— ë§¤í•‘ëœ í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬)ë¥¼ ì¡°íšŒí•œë‹¤.
2. **í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ì¡°íšŒ**: í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë¥¼ ì¡°íšŒí•œë‹¤.
3. **í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ì‹¤í–‰**: í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë¥¼ ì‹¤í–‰í•œë‹¤.
4. **í•¸ë“¤ëŸ¬ ì‹¤í–‰**: í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ê°€ ì‹¤ì œ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•œë‹¤.
5. **ModelAndView ë°˜í™˜**: í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ëŠ” í•¸ë“¤ëŸ¬ê°€ ë°˜í™˜í•˜ëŠ” ì •ë³´ë¥¼ ModelAndViewë¡œ **ë³€í™˜**í•´ì„œ
ë°˜í™˜í•œë‹¤.
6. **viewResolver í˜¸ì¶œ**: ë·° ë¦¬ì¡¸ë²„ë¥¼ ì°¾ê³  ì‹¤í–‰í•œë‹¤.
    - JSPì˜ ê²½ìš°: InternalResourceViewResolver ê°€ ìë™ ë“±ë¡ë˜ê³ , ì‚¬ìš©ëœë‹¤.
7. **Viewë°˜í™˜**: ë·° ë¦¬ì¡¸ë²„ëŠ” ë·°ì˜ ë…¼ë¦¬ ì´ë¦„ì„ ë¬¼ë¦¬ ì´ë¦„ìœ¼ë¡œ ë°”ê¾¸ê³ ,ë Œë”ë§ ì—­í• ì„ ë‹´ë‹¹í•˜ëŠ” ë·° ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.
    - JSPì˜ ê²½ìš° InternalResourceView(JstlView) ë¥¼ ë°˜í™˜í•˜ëŠ”ë°, ë‚´ë¶€ì— forward() ë¡œì§ì´ ìˆë‹¤.
8. **ë·°ë Œë”ë§**: ë·°ë¥¼ í†µí•´ì„œ ë·°ë¥¼ ë Œë”ë§ í•œë‹¤.

<aside>
ğŸ—£ **ì¸í„°í˜ì´ìŠ¤ ì‚´í´ë³´ê¸°**
ìŠ¤í”„ë§ MVCì˜ í° ê°•ì ì€ DispatcherServlet ì½”ë“œì˜ ë³€ê²½ ì—†ì´, ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ë³€ê²½í•˜ê±°ë‚˜ í™•ì¥í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤. ì§€ê¸ˆê¹Œì§€ ì„¤ëª…í•œ ëŒ€ë¶€ë¶„ì„ í™•ì¥ ê°€ëŠ¥í•  ìˆ˜ ìˆê²Œ ì¸í„°í˜ì´ìŠ¤ë¡œ ì œê³µí•œë‹¤.
ì´ ì¸í„°í˜ì´ìŠ¤ë“¤ë§Œ êµ¬í˜„í•´ì„œ DispatcherServlet ì— ë“±ë¡í•˜ë©´ ì—¬ëŸ¬ë¶„ë§Œì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤.

>> ì£¼ìš” ì¸í„°í˜ì´ìŠ¤ ëª©ë¡
- í•¸ë“¤ëŸ¬ ë§¤í•‘: org.springframework.web.servlet.HandlerMapping
- í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°: org.springframework.web.servlet.HandlerAdapter
- ë·° ë¦¬ì¡¸ë²„: org.springframework.web.servlet.ViewResolver
- ë·°: org.springframework.web.servlet.View

</aside>

# **í•¸ë“¤ëŸ¬ ë§¤í•‘ê³¼ í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°**

**Controller ì¸í„°í˜ì´ìŠ¤
ê³¼ê±° ë²„ì „ ìŠ¤í”„ë§ ì»¨íŠ¸ë¡¤ëŸ¬ â†’** org.springframework.web.servlet.mvc.Controller

```java
public interface Controller {

	ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse
    response) throws Exception;
}
```

**ì°¸ê³ :** Controller ì¸í„°í˜ì´ìŠ¤ëŠ” @Controller ì• ë…¸í…Œì´ì…˜ê³¼ëŠ” ì „í˜€ ë‹¤ë¥´ë‹¤.

```java
@Component("/springmvc/old-controller")
public class OldController implements Controller {
    @Override
    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception {
        System.out.println("OldController.handleRequest");
        return null;
    }
}
```

@Component : ì´ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” /springmvc/old-controller ë¼ëŠ” ì´ë¦„ì˜ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì—ˆë‹¤.
**ë¹ˆì˜ ì´ë¦„ìœ¼ë¡œ URLì„ ë§¤í•‘**í•  ê²ƒì´ë‹¤.

â†’ ì´ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œë˜ë ¤ë©´ ë‹¤ìŒ 2ê°€ì§€ê°€ í•„ìš”í•˜ë‹¤.

1. **HandlerMapping(í•¸ë“¤ëŸ¬ ë§¤í•‘)**
- í•¸ë“¤ëŸ¬ ë§¤í•‘ì—ì„œ ì´ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì°¾ì„ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.
ì˜ˆ) **ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë¦„ìœ¼ë¡œ í•¸ë“¤ëŸ¬ë¥¼ ì°¾ì„ ìˆ˜ ìˆëŠ” í•¸ë“¤ëŸ¬ ë§¤í•‘**ì´ í•„ìš”í•˜ë‹¤.
1. **HandlerAdapter(í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°)**
- í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ í†µí•´ì„œ ì°¾ì€ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ê°€ í•„ìš”í•˜ë‹¤.
ì˜ˆ) Controller ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë¥¼ ì°¾ê³  ì‹¤í–‰í•´ì•¼ í•œë‹¤.

**ì •ë¦¬ - OldController í•¸ë“¤ëŸ¬ë§¤í•‘, ì–´ëŒ‘í„°**

OldController ë¥¼ ì‹¤í–‰í•˜ë©´ì„œ ì‚¬ìš©ëœ ê°ì²´ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

- HandlerMapping = BeanNameUrlHandlerMapping
- HandlerAdapter = SimpleControllerHandlerAdapter

**HttpRequestHandler (**SimpleControllerHandlerAdapterâ†’**HttpRequestHandler)**

í•¸ë“¤ëŸ¬ ë§¤í•‘ê³¼, ì–´ëŒ‘í„°ë¥¼ ë” ì˜ ì´í•´í•˜ê¸° ìœ„í•´ Controller ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹Œ ë‹¤ë¥¸ í•¸ë“¤ëŸ¬ë¥¼ ì•Œì•„ë³´ì.
HttpRequestHandler í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬)ëŠ” **ì„œë¸”ë¦¿ê³¼ ê°€ì¥ ìœ ì‚¬í•œ í˜•íƒœ**ì˜ í•¸ë“¤ëŸ¬ì´ë‹¤.

```java
@Component("/springmvc/request-handler")
public class MyHttpRequestHandler implements HttpRequestHandler {
    @Override
    public void handleRequest(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        System.out.println("MyHttpRequestHandler.handleRequest");
    }
}
```

**ì •ë¦¬ - MyHttpRequestHandler í•¸ë“¤ëŸ¬ë§¤í•‘, ì–´ëŒ‘í„°**
MyHttpRequestHandler ë¥¼ ì‹¤í–‰í•˜ë©´ì„œ ì‚¬ìš©ëœ ê°ì²´ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

- HandlerMapping = BeanNameUrlHandlerMapping
- HandlerAdapter = HttpRequestHandlerAdapter

<aside>
ğŸ—£ **@RequestMapping**

ì¡°ê¸ˆ ë’¤ì—ì„œ ì„¤ëª…í•˜ê² ì§€ë§Œ, ê°€ì¥ ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ í•¸ë“¤ëŸ¬ ë§¤í•‘ê³¼ í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ëŠ”
RequestMappingHandlerMapping, RequestMappingHandlerAdapter ì´ë‹¤.
@RequestMapping ì˜ ì•ê¸€ìë¥¼ ë”°ì„œ ë§Œë“  ì´ë¦„ì¸ë°, ì´ê²ƒì´ ë°”ë¡œ ì§€ê¸ˆ ìŠ¤í”„ë§ì—ì„œ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì§€ì›í•˜ëŠ” ë§¤í•‘ê³¼ ì–´ëŒ‘í„°ì´ë‹¤. 

ì‹¤ë¬´ì—ì„œëŠ” 99.9% ì´ ë°©ì‹ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‚¬ìš©í•œë‹¤.

</aside>

# **ë·° ë¦¬ì¡¸ë²„**

**ë·° ë¦¬ì¡¸ë²„ - InternalResourceViewResolver**

ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” InternalResourceViewResolver ë¼ëŠ” ë·° ë¦¬ì¡¸ë²„ë¥¼ ìë™ìœ¼ë¡œ ë“±ë¡í•˜ëŠ”ë°, 

ì´ë•Œ application.properties ì— ë“±ë¡í•œ spring.mvc.view.prefix , spring.mvc.view.suffix ì„¤ì • ì •ë³´ë¥¼ ì‚¬ìš©í•´ì„œ ë“±ë¡í•œë‹¤.

>> ì°¸ê³ ë¡œ ê¶Œì¥í•˜ì§€ëŠ” ì•Šì§€ë§Œ ì„¤ì • ì—†ì´ ë‹¤ìŒê³¼ ê°™ì´ ì „ì²´ ê²½ë¡œë¥¼ ì£¼ì–´ë„ ë™ì‘í•˜ê¸°ëŠ” í•œë‹¤. 

return new ModelAndView("/WEB-INF/views/new-form.jsp");

# **ìŠ¤í”„ë§ MVC - ì‹œì‘í•˜ê¸°**

```java
@Controller
public class SpringMemberFormControllerV1 {

    @RequestMapping("/springmvc/v1/members/new-form")
    public ModelAndView process(){
        return new ModelAndView("new-form"); 
    }
}
```

- @Controller :
ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤. (ë‚´ë¶€ì— @Component ì• ë…¸í…Œì´ì…˜ì´ ìˆì–´ì„œ ì»´í¬ë„ŒíŠ¸
ìŠ¤ìº”ì˜ ëŒ€ìƒì´ ë¨) ìŠ¤í”„ë§ MVCì—ì„œ ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì¸ì‹í•œë‹¤.
- @RequestMapping : ìš”ì²­ ì •ë³´ë¥¼ ë§¤í•‘í•œë‹¤. í•´ë‹¹ URLì´ í˜¸ì¶œë˜ë©´ ì´ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤. ì• ë…¸í…Œì´ì…˜ì„ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì—, ë©”ì„œë“œì˜ ì´ë¦„ì€ ì„ì˜ë¡œ ì§€ìœ¼ë©´ ëœë‹¤.
- ModelAndView : ëª¨ë¸ê³¼ ë·° ì •ë³´ë¥¼ ë‹´ì•„ì„œ ë°˜í™˜í•˜ë©´ ëœë‹¤.

# **ìŠ¤í”„ë§ MVC - ì»¨íŠ¸ë¡¤ëŸ¬ í†µí•©**

â€¼ï¸Â @RequestMapping ì„ ì˜ ë³´ë©´ í´ë˜ìŠ¤ ë‹¨ìœ„ê°€ ì•„ë‹ˆë¼ ë©”ì„œë“œ ë‹¨ìœ„ì— ì ìš©ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤ë¥¼ ìœ ì—°í•˜ê²Œ í•˜ë‚˜ë¡œ í†µí•©í•  ìˆ˜ ìˆë‹¤.

```java
@Controller
@RequestMapping("/springmvc/v2/members") //-> ê²¹ì¹˜ëŠ” ë¶€ë¶„
public class SpringMemberControllerV2 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @RequestMapping("/new-form")
    public ModelAndView newForm(){
        return new ModelAndView("new-form");
    }
    @RequestMapping("/save")
    public ModelAndView save(HttpServletRequest request, HttpServletResponse response) {
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        Member member = new Member(username, age);
        memberRepository.save(member);

        ModelAndView mv = new ModelAndView("save-result");
//        mv.getModel().put("member",member);
        mv.addObject("member",member);
        return mv;

    }
    @RequestMapping
    public ModelAndView members() {
        List<Member> members = memberRepository.findAll();
        ModelAndView mv = new ModelAndView("members");
//        mv.getModel().put("members",members);
        mv.addObject("members",members);

        return mv;
    }
}
```

**ì¡°í•©**

ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤ë¥¼ í†µí•©í•˜ëŠ” ê²ƒì„ ë„˜ì–´ì„œ ì¡°í•©ë„ ê°€ëŠ¥í•˜ë‹¤.
ë‹¤ìŒ ì½”ë“œëŠ” /springmvc/v2/members ë¼ëŠ” ë¶€ë¶„ì— ì¤‘ë³µì´ ìˆë‹¤.

@RequestMapping("/springmvc/v2/members/new-form")
@RequestMapping("/springmvc/v2/members")
@RequestMapping("/springmvc/v2/members/save")

**ì¡°í•© ê²°ê³¼**

í´ë˜ìŠ¤ ë ˆë²¨ @RequestMapping("/springmvc/v2/members")

- ë©”ì„œë“œ ë ˆë²¨ @RequestMapping("/new-form") â¡ï¸ /springmvc/v2/members/new-form
- ë©”ì„œë“œ ë ˆë²¨ @RequestMapping("/save") â¡ï¸  /springmvc/v2/members/save
- ë©”ì„œë“œ ë ˆë²¨ @RequestMapping â¡ï¸  /springmvc/v2/members

# **ìŠ¤í”„ë§ MVC - ì‹¤ìš©ì ì¸ ë°©ì‹**

**@RequestParam ì‚¬ìš©**

ìŠ¤í”„ë§ì€ HTTP ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ @RequestParam ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.
@RequestParam("username") ì€ request.getParameter("username") ì™€ ê±°ì˜ ê°™ì€ ì½”ë“œë¼
ìƒê°í•˜ë©´ ëœë‹¤.
ë¬¼ë¡  GET ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°, POST Form ë°©ì‹ì„ ëª¨ë‘ ì§€ì›í•œë‹¤.

```java
public String save(
            @RequestParam("username") String username,
            @RequestParam("age") int age,
            Model model) {
...
}
```

**@RequestMapping â†’ @GetMapping, @PostMapping**

@RequestMapping ì€ URLë§Œ ë§¤ì¹­í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, HTTP Methodë„ í•¨ê»˜ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ì„œ URLì´ /new-form ì´ê³ , HTTP Methodê°€ GETì¸ ê²½ìš°ë¥¼ ëª¨ë‘ ë§Œì¡±í•˜ëŠ” ë§¤í•‘ì„ í•˜ë ¤ë©´
ë‹¤ìŒê³¼ ê°™ì´ ì²˜ë¦¬í•˜ë©´ ëœë‹¤.

```java
  @RequestMapping(value = "/new-form", method = RequestMethod.GET)
= @GetMapping("/new-form")
```

ì´ê²ƒì„ @GetMapping , @PostMapping ìœ¼ë¡œ ë” í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì°¸ê³ ë¡œ Get, Post, Put, Delete, Patch ëª¨ë‘ ì• ë…¸í…Œì´ì…˜ì´ ì¤€ë¹„ë˜ì–´ ìˆë‹¤.
